# Copyright (c) 2022 YuLong Yao <feilongphone@gmail.com>
# SPDX-License-Identifier: Apache-2.0

if(CONFIG_HAS_AT32_HAL)

string(TOUPPER ${CONFIG_SOC} at32_soc_uc)

set(at32_soc_dir     ${ZEPHYR_HAL_ARTERY_MODULE_DIR}/${CONFIG_SOC_SERIES})
if(CONFIG_SOC_FAMILY_AT32_ARM)
  set(at32_soc_sys_dir   ${at32_soc_dir}/cmsis/cm4/device_support/)
endif()

set(at32_std_dir     ${at32_soc_dir}/drivers)
set(at32_std_src_dir ${at32_std_dir}/src)

zephyr_library_named(hal_artery)

zephyr_compile_definitions(${at32_soc_uc})

# change to value from dts later
if(${CONFIG_AT32_HXTAL_8MHZ})
  zephyr_compile_definitions(HEXT_VALUE=8000000)
elseif(${CONFIG_AT32_HXTAL_25MHZ})
  zephyr_compile_definitions(HEXT_VALUE=25000000)
else()
  message(FATAL_ERROR "SOC SERIES Not Support at this time")
endif()

# Global includes to be used outside hal_artery
zephyr_include_directories(${at32_soc_sys_dir})
zephyr_include_directories(${at32_std_dir}/inc)
zephyr_include_directories(${ZEPHYR_HAL_ARTERY_MODULE_DIR}/include)

if(${CONFIG_BOARD_AT32F437_SURF})
  zephyr_compile_definitions(AT32F437ZMT7)
endif()

zephyr_library_sources(${at32_soc_sys_dir}/system_${CONFIG_SOC_SERIES}.c)

zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_ACC      ACC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_ADC      ADC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_CAN      CAN_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_CRC      CRC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_CRM      CRM_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_DAC      DAC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_DBG      DEBUG_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_DMA      DMA_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_DVP      DVP_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_EDMA     EDMA_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_EMAC     EMAC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_ERTC     ERTC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_EXINT    EXINT_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_FLASH    FLASH_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_GPIO     GPIO_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_I2C      I2C_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_MISC     MISC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_PWC      PWC_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_QSPI     QSPI_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_SCFG     SCFG_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_SDIO     SDIO_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_SPI      SPI_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_TMR    TMR_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_USART    USART_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_WDT      WDT_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_WWDGT    WWDT_MODULE_ENABLED)
zephyr_compile_definitions_ifdef(CONFIG_USE_AT32_XMC      XMC_MODULE_ENABLED)

zephyr_library_sources_ifdef(CONFIG_USE_AT32_ACC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_acc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_ADC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_adc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_CAN      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_can.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_CRC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_crc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_CRM      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_crm.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_DAC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_dac.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_DBG      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_debug.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_DMA      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_dma.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_DVP      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_dvp.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_EDMA     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_edma.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_EMAC     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_emac.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_ERTC     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_ertc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_EXINT    ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_exint.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_FLASH    ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_flash.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_GPIO     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_gpio.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_I2C      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_i2c.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_MISC     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_misc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_PWC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_pwc.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_QSPI     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_qspi.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_SCFG     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_scfg.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_SDIO     ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_sdio.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_SPI      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_spi.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_TMR      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_tmr.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_USART    ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_usart.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_WDT      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_wdt.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_WWDGT    ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_wwdgt.c)
zephyr_library_sources_ifdef(CONFIG_USE_AT32_XMC      ${at32_std_src_dir}/${CONFIG_SOC_SERIES}_xmc.c)

endif()
